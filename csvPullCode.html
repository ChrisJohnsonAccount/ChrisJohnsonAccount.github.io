<html>
<script src='https://d3js.org/d3.v5.min.js'></script>
<style>
    circle {
        fill: lightblue;
        stroke: black;
    }
</style>

<body onload='init()'>
    <svg width=300 height=300>
    </svg>
    <script>
        async function init() {

            const data = await d3.csv('https://flunky.github.io/cars2017.csv');
            console.log('csvData downloaded');

            var margin = { top: 50, right: 50, bottom: 50, left: 50 };
            var width = 300 - margin.left - margin.right;
            var height = 300 - margin.top - margin.bottom;

            var xScale = d3.scaleLog()
                .domain([10, 150])
                .range([0, width])
                .base(10);

            var yScale = d3.scaleLog()
                .domain([10, 150])
                .range([height, 0])
                .base(10);

            var xAxis = d3.axisBottom()
                .scale(xScale)
                .tickValues([10, 20, 50, 100])
                .tickFormat(d3.format("~s"));

            var yAxis = d3.axisLeft()
                .scale(yScale)
                .tickValues([10, 20, 50, 100])
                .tickFormat(d3.format("~s"));

            d3.select("svg")
                .attr("width", width + margin.left + margin.right)
                .attr("height", height + margin.top + margin.bottom)
                .append("g")
                .attr("transform", "translate(50,50)")
                .selectAll("circle").data(data)
                .enter().append("circle")
                .attr("cx", function (d, i) { return xScale(d.AverageCityMPG); })
                .attr("cy", function (d, i) { return yScale(d.AverageHighwayMPG); })
                .attr("r", function (d) { return Math.round(Math.sqrt(d.EngineCylinders + 2)); });


            d3.select("svg").append("g")
                .attr("transform", "translate(50,50)")
                .call(yAxis);

            d3.select("svg").append("g")
                .attr("transform", "translate(50,250)")
                .call(xAxis);



        }

    </script>
</body>

</html>